# GPU 최대 활용 설정 - A100 40GB 기준
# Batch size 크게 늘려서 GPU 100% 활용

seed: 42

# Data Configuration - GPU 최적화
data:
  train_json_dirs:
    - "/home/work/CUAI_DATA/김현수/train_valid/train/report_json"
    - "/home/work/CUAI_DATA/김현수/train_valid/train/press_json"
  train_jpg_dirs:
    - "/home/work/CUAI_DATA/김현수/train_valid/train/report_jpg"
    - "/home/work/CUAI_DATA/김현수/train_valid/train/press_jpg"

  val_json_dirs:
    - "/home/work/CUAI_DATA/김현수/train_valid/valid/report_json"
    - "/home/work/CUAI_DATA/김현수/train_valid/valid/press_json"
  val_jpg_dirs:
    - "/home/work/CUAI_DATA/김현수/train_valid/valid/report_jpg"
    - "/home/work/CUAI_DATA/김현수/train_valid/valid/press_jpg"

  img_size: 640
  num_workers: 0  # CPU 코어 수에 맞게 증가

# Model Configuration
model:
  model_type: "grounding_dino"
  dim: 256
  text_encoder: "bert"
  vision_encoder: "resnet18"
  pretrained_backbone: true
  freeze_bert: false
  freeze_vision_encoder: false
  freeze_text_encoder: false
  use_adapter: true
  adapter_config:
    reduction: 4
  num_queries: 100
  num_decoder_layers: 6
  num_heads: 8
  num_points: 4
  dropout: 0.1

training:
  batch_size: 64  # A100 40GB는 64도 가능
  gradient_accumulation_steps: 1  # batch_size 크면 1로
  epochs: 100
  learning_rate: 0.00015 # batch_size 크면 LR도 증가
  weight_decay: 1.0e-4
  adapter_lr_scale: 2.0
  use_amp: true  # Mixed precision 필수
  use_giou_loss: true
  grad_clip: 1.0
  save_ckpt: "checkpoints/grounding_dino_gpu_max.pth"
  save_interval: 5
  eval_interval: 1
  early_stopping_patience: 20

# Evaluation Configuration
eval:
  json_dirs:
    - "/home/work/CUAI_DATA/김현수/train_valid/valid/report_json"
    - "/home/work/CUAI_DATA/김현수/train_valid/valid/press_json"
  jpg_dirs:
    - "/home/work/CUAI_DATA/김현수/train_valid/valid/report_jpg"
    - "/home/work/CUAI_DATA/김현수/train_valid/valid/press_jpg"
  batch_size: 64
  out_csv: "results/val_predictions_gpu_max.csv"

# Prediction Configuration
predict:
  json_dir: "test/query"
  jpg_dir: "test/images"
  batch_size: 64
  out_csv: "results/submission.csv"
